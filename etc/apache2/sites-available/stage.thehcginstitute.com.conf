<VirtualHost 167.71.186.128:80>
    SuexecUserGroup "#1002" "#1002"
    ServerName stage.thehcginstitute.com
    ServerAlias www.stage.thehcginstitute.com
    ServerAlias mail.stage.thehcginstitute.com
    ServerAlias webmail.stage.thehcginstitute.com
    ServerAlias admin.stage.thehcginstitute.com
    DocumentRoot /home/thehcg-stage/public_html
    ErrorLog /var/log/virtualmin/stage.thehcginstitute.com_error_log
    CustomLog /var/log/virtualmin/stage.thehcginstitute.com_access_log combined
    ScriptAlias /cgi-bin/ /home/thehcg-stage/cgi-bin/
    ScriptAlias /awstats/ /home/thehcg-stage/cgi-bin/
    DirectoryIndex index.php index.php4 index.php5 index.htm index.html
    <Directory /home/thehcg-stage/public_html>
    Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch +ExecCGI
    allow from all
    AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    Require all granted
    </Directory>
    <Directory /home/thehcg-stage/cgi-bin>
    allow from all
    AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    Require all granted
    </Directory>
    RewriteEngine on
    RewriteCond %{HTTP_HOST} =webmail.stage.thehcginstitute.com
    RewriteRule ^(?!/.well-known)(.*) https://stage.thehcginstitute.com:20000/ [R]
    RewriteCond %{HTTP_HOST} =admin.stage.thehcginstitute.com
    RewriteRule ^(?!/.well-known)(.*) https://stage.thehcginstitute.com:10000/ [R]
    RemoveHandler .php
    RemoveHandler .php7.1
    RemoveHandler .php7.4
<Files awstats.pl>
AuthName "stage.thehcginstitute.com statistics"
AuthType Basic
AuthUserFile /home/thehcg-stage/.awstats-htpasswd
require valid-user
</Files>
<FilesMatch \.php$>
    SetHandler proxy:fcgi://localhost:8001
</FilesMatch>
</VirtualHost>
<VirtualHost 167.71.186.128:443>
    SuexecUserGroup "#1002" "#1002"
    ServerName stage.thehcginstitute.com
    ServerAlias www.stage.thehcginstitute.com
    ServerAlias mail.stage.thehcginstitute.com
    ServerAlias webmail.stage.thehcginstitute.com
    ServerAlias admin.stage.thehcginstitute.com
    DocumentRoot /home/thehcg-stage/public_html
    ErrorLog /var/log/virtualmin/stage.thehcginstitute.com_error_log
    CustomLog /var/log/virtualmin/stage.thehcginstitute.com_access_log combined
    ScriptAlias /cgi-bin/ /home/thehcg-stage/cgi-bin/
    ScriptAlias /awstats/ /home/thehcg-stage/cgi-bin/
    DirectoryIndex index.php index.php4 index.php5 index.htm index.html
    <Directory /home/thehcg-stage/public_html>
		Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch +ExecCGI
		allow from all
		AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
		Require all granted
    </Directory>
    <Directory /home/thehcg-stage/cgi-bin>
    allow from all
    AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    Require all granted
    </Directory>
    RewriteEngine on
    RewriteCond %{HTTP_HOST} =webmail.stage.thehcginstitute.com
    RewriteRule ^(?!/.well-known)(.*) https://stage.thehcginstitute.com:20000/ [R]
    RewriteCond %{HTTP_HOST} =admin.stage.thehcginstitute.com
    RewriteRule ^(?!/.well-known)(.*) https://stage.thehcginstitute.com:10000/ [R]
    RemoveHandler .php
    RemoveHandler .php7.1
    RemoveHandler .php7.4
<Files awstats.pl>
AuthName "stage.thehcginstitute.com statistics"
AuthType Basic
AuthUserFile /home/thehcg-stage/.awstats-htpasswd
require valid-user
</Files>
SSLEngine on
SSLCertificateFile /home/thehcg-stage/ssl.cert
SSLCertificateKeyFile /home/thehcg-stage/ssl.key
SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
SSLCACertificateFile /home/thehcg-stage/ssl.ca
<FilesMatch \.php$>
    SetHandler proxy:fcgi://localhost:8001
</FilesMatch>
</VirtualHost>
